# 用户管理功能说明

## ✨ 新增功能

管理员现在可以:
1. ✅ **编辑用户信息** - 修改用户姓名、角色
2. ✅ **修改用户密码** - 包括自己和其他用户的密码
3. ✅ **添加新用户** - 创建新用户并设置初始密码
4. ✅ **删除用户** - 删除不需要的用户

## 🎯 功能详情

### 1. 编辑用户信息

**操作步骤:**
1. 登录管理员账号
2. 进入"系统管理" → "用户管理"
3. 点击用户列表中的"编辑"按钮(蓝色笔形图标)
4. 修改用户信息:
   - **姓名** - 可以修改
   - **角色** - 可以在评委/述职人员/管理员之间切换
   - **密码** - 可以修改(留空则保持原密码)
5. 点击"保存"

### 2. 修改密码

#### 修改其他用户密码
1. 点击"编辑"按钮
2. 在"密码"字段输入新密码
3. 点击"保存"
4. 该用户下次登录时需使用新密码

#### 修改自己的密码
1. 找到自己的用户
2. 点击"编辑"按钮
3. 输入新密码
4. 点击"保存"
5. **注意**: 下次登录需使用新密码

#### 保持原密码
- 编辑用户时,如果**不想修改密码**
- 将密码字段**留空**
- 系统会保留原密码

### 3. 添加新用户

**操作步骤:**
1. 点击"添加用户"按钮
2. 填写信息:
   - **姓名**: 用户的显示名称
   - **角色**: 选择评委/述职人员/管理员
   - **密码**: 设置初始密码(默认: 123456)
3. 点击"添加"
4. 新用户可以使用设置的密码登录

### 4. 删除用户

**操作步骤:**
1. 点击用户列表中的"删除"按钮(红色垃圾桶图标)
2. 确认删除
3. **警告**: 删除用户会同时删除该用户的所有评分记录

## 📋 界面说明

### 用户列表

| 列名 | 说明 |
|------|------|
| 姓名 | 用户的显示名称 |
| 角色 | 评委/述职人员/管理员(带颜色标签) |
| 默认密码 | 显示为 123456(实际密码已加密) |
| 操作 | 编辑/删除按钮 |

### 编辑用户对话框

```
┌─────────────────────────────┐
│ 编辑用户                      │
├─────────────────────────────┤
│ 姓名: [评委张三        ]     │
│ 角色: [评委 ▼]               │
│ 密码: [              ]       │
│      (留空保持原密码)         │
│      修改密码后用户需使用     │
│      新密码登录               │
├─────────────────────────────┤
│              [取消] [保存]    │
└─────────────────────────────┘
```

## 🔐 安全说明

### 密码管理
1. **密码明文显示** (当前版本)
   - 仅用于演示环境
   - 管理员可以看到和设置密码
   
2. **生产环境建议**
   - 使用密码哈希(bcrypt)
   - 不显示实际密码
   - 提供"重置密码"功能而非"查看密码"

### 权限控制
- ✅ 只有**管理员**可以访问用户管理
- ✅ 管理员可以修改**所有用户**的信息
- ✅ 管理员可以修改**自己**的密码
- ⚠️ 删除用户会删除其所有评分数据

## 🎨 操作图标

| 图标 | 颜色 | 功能 |
|------|------|------|
| ✏️ (Edit2) | 蓝色 | 编辑用户 |
| 🗑️ (Trash2) | 红色 | 删除用户 |
| ➕ (Plus) | 白色(紫色背景) | 添加用户 |

## 💡 使用场景

### 场景 1: 员工入职
1. 管理员添加新用户
2. 设置角色(评委/述职人员)
3. 设置初始密码
4. 告知员工用户名和密码

### 场景 2: 角色调整
1. 员工从述职人员变为评委
2. 管理员编辑该用户
3. 修改角色为"评委"
4. 保存

### 场景 3: 密码忘记
1. 用户向管理员申请重置密码
2. 管理员编辑该用户
3. 设置新密码
4. 告知用户新密码

### 场景 4: 管理员换人
1. 新管理员账号已创建
2. 原管理员编辑自己的账号
3. 修改角色为"评委"或"述职人员"
4. 或直接删除旧管理员账号

### 场景 5: 员工离职
1. 管理员找到该用户
2. 点击删除按钮
3. 确认删除
4. 该用户的所有数据被清除

## 🔄 数据更新逻辑

### 更新用户信息
```typescript
// 只更新提供的字段
updateUser(userId, {
  name: '新名字',        // 可选
  role: 'admin',        // 可选
  password: '新密码'     // 可选(留空则不更新)
})
```

### API 接口

**PUT /api/users**

请求:
```json
{
  "id": "user-uuid",
  "name": "新名字",
  "role": "admin",
  "password": "新密码"  // 可选
}
```

响应:
```json
{
  "success": true
}
```

## ⚠️ 注意事项

1. **修改密码后立即生效**
   - 用户下次登录需使用新密码
   - 建议修改后及时通知用户

2. **删除用户不可恢复**
   - 删除前请确认
   - 用户的所有评分数据会一起删除

3. **角色修改影响权限**
   - 修改为管理员后可访问管理功能
   - 修改为评委后只能评分
   - 修改为述职人员后只能查看成绩

4. **不要删除自己正在使用的账号**
   - 可能导致无法登录
   - 建议先创建新管理员再删除旧账号

5. **保留空密码的逻辑**
   - 编辑时密码留空 = 不修改密码
   - 添加时密码留空 = 使用默认密码(123456)

## 🧪 测试建议

1. **测试编辑姓名**
   - 修改用户姓名
   - 验证在其他页面显示更新

2. **测试修改角色**
   - 将评委改为述职人员
   - 重新登录验证权限变化

3. **测试修改密码**
   - 修改某用户密码
   - 使用新密码登录
   - 验证旧密码无法登录

4. **测试保持密码**
   - 编辑用户但密码留空
   - 保存后用原密码登录
   - 验证密码未改变

5. **测试删除用户**
   - 删除用户
   - 验证用户列表中不再显示
   - 验证无法使用该账号登录

## 📝 数据库变更

无需额外的数据库变更,使用现有的 users 表。

已有字段:
- `id` - 用户ID
- `name` - 姓名
- `role` - 角色
- `password` - 密码
- `created_at` - 创建时间

## 🎯 后续优化建议

1. **密码加密**
   - 使用 bcrypt 哈希密码
   - 不以明文存储

2. **密码验证**
   - 密码强度检查
   - 最小长度限制

3. **操作日志**
   - 记录谁修改了谁的信息
   - 记录修改时间和内容

4. **批量操作**
   - 批量导入用户
   - 批量修改密码

5. **自助修改密码**
   - 允许用户修改自己的密码
   - 需要验证旧密码
